#!/usr/bin/env node
/* eslint-disable no-console */

const XUClient = require('../lib/xuclient/xuclient');
const commandLineArgs = require('command-line-args');

const argDefinitions = [
  {
    name: 'rpcport', alias: 'r', type: Number, defaultValue: 8886,
  },
  { name: 'call', type: String, defaultOption: true },
  { name: 'quantity', type: Number },
  { name: 'price', type: Number },
  { name: 'host', type: String },
  { name: 'port', type: Number },
];
const args = commandLineArgs(argDefinitions);

const xuClient = new XUClient(args.rpcport);

let promise;
switch (args.call) {
  case 'getinfo':
    promise = xuClient.getInfo();
    break;
  case 'getorders':
    promise = xuClient.getOrders();
    break;
  case 'placeorder': {
    const order = {
      price: args.price,
      quantity: args.quantity,
    };
    promise = xuClient.placeOrder(order);
    break;
  }
  case 'connect': {
    promise = xuClient.connect(args.host, args.port);
    break;
  }
  default:
    console.error(`${args.call} not recognized as a call`);
}

if (promise) {
  promise.then((result) => {
    console.log(JSON.stringify(result));
  }).catch((err) => {
    console.error(err);
  });
}
